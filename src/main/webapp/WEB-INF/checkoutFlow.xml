<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow
        http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

	<var name="shippingAddress" class="com.khozema.iniitian.entity.ShippingAddress"/>
	<var name="billingAddress" class="com.khozema.iniitian.entity.BillingAddress"/>
	<var name="cardDetail" class="com.khozema.iniitian.entity.CardDetail"/>
	<var name="orderDetail" class="com.khozema.iniitian.entity.OrderDetail"/>

	<on-start>
		<evaluate expression="orderController.initFlow()" result="flowScope.orderDetail"/>
	</on-start>

	<view-state id="checkout" view="public/shipping" model="shippingAddress">
		<transition on="submitShippingDetails" to="shippingDetails"/>
	</view-state>

	<action-state id="shippingDetails">
		<evaluate expression="orderController.addShippingDetail(flowScope.orderDetail, shippingAddress)"/>
		<transition on="success" to="viewBillingDetails"/>
	</action-state>

	<view-state id="viewBillingDetails" view="public/billing" model="billingAddress">
		<transition on="submitBillingDetails" to="billingDetails"/>
	</view-state>

	<action-state id="billingDetails">
		<evaluate expression="orderController.addBillingDetail(flowScope.orderDetail, billingAddress)"/>
		<transition on="success" to="viewPaymentDetails"/>
	</action-state>
	
	<view-state id="viewPaymentDetails" view="public/payment" model="cardDetail">
		<transition on="submitPaymentDetails" to="paymentDetails"/>
	</view-state>


	<action-state id="paymentDetails">
		<evaluate expression="orderController.confirmOrder(flowScope.orderDetail, cardDetail)"/>
		<transition on="success" to="orderConfirm"/>
	</action-state>
	

	<end-state id="orderConfirm" view="public/orderConfirmed"/>	
	<end-state id="toViewCart" view="externalRedirect:contextRelative:/user/viewCart"/>
	
	<global-transitions>
		<transition on="cancel" to="toViewCart" />
	</global-transitions>

</flow>